<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hexapod Control</title>

<style>
body{
  margin:0;
  background:linear-gradient(180deg,#0f2a44,#1e4f8a);
  color:#fff;
  font-family:system-ui;
  text-align:center;
}
.card{
  background:rgba(255,255,255,0.1);
  margin:20px;
  padding:25px;
  border-radius:20px;
}
button{
  padding:14px 26px;
  border:none;
  border-radius:999px;
  font-size:16px;
  font-weight:bold;
  background:#ffd24d;
  color:#0f2a44;
}
button:active{transform:scale(0.95);}
.mode.active{background:#ff9f1c;}

.joy{
  width:220px;height:220px;border-radius:50%;
  background:rgba(255,255,255,0.15);
  margin:20px auto;position:relative;
}
.stick{
  width:70px;height:70px;border-radius:50%;
  background:#ffd24d;position:absolute;
  left:75px;top:75px;
}
input[type=range]{width:80%;}
</style>
</head>

<body>

<h1>üï∑ Hexapod Robot</h1>

<div class="card">
  <button class="mode active" onclick="setMode('joy',this)">üïπ Joystick</button>
  <button class="mode" onclick="setMode('calib',this)">‚öô Calib</button>

  <div id="joyBox">
    <div class="joy" id="joy">
      <div class="stick" id="stick"></div>
    </div>

    <p>‚ö° T·ªëc ƒë·ªô</p>
    <input type="range" min="1" max="10" value="5" id="speed">
  </div>

  <div id="calibBox" style="display:none">
    <button onclick="calib()">ƒê∆∞a to√†n b·ªô servo v·ªÅ 90¬∞</button>
  </div>
</div>

<script>
let mode="joy";
const joy=document.getElementById("joy");
const stick=document.getElementById("stick");
const speed=document.getElementById("speed");

function setMode(m,b){
  mode=m;
  joyBox.style.display=m==="joy"?"block":"none";
  calibBox.style.display=m==="calib"?"block":"none";
  document.querySelectorAll(".mode").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
}

function calib(){ fetch("/cmd?c=CALIB"); }

joy.addEventListener("pointermove",e=>{
  if(mode!=="joy"||!e.buttons) return;
  let r=joy.getBoundingClientRect();
  let x=e.clientX-r.left-110;
  let y=e.clientY-r.top-110;
  x=Math.max(-80,Math.min(80,x));
  y=Math.max(-80,Math.min(80,y));
  stick.style.left=(x+75)+"px";
  stick.style.top=(y+75)+"px";
  fetch(`/joy?x=${x}&y=${y}&s=${speed.value}`);
});

joy.addEventListener("pointerup",()=>{
  stick.style.left="75px";
  stick.style.top="75px";
  fetch("/joy?x=0&y=0");
});
</script>

</body>
</html>
